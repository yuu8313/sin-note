var w=Object.defineProperty,A=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var y=(e,t,o)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,f=(e,t)=>{for(var o in t||(t={}))M.call(t,o)&&y(e,o,t[o]);if(m)for(var o of m(t))z.call(t,o)&&y(e,o,t[o]);return e},p=(e,t)=>A(e,D(t));import{c as u,a as x}from"./toolkit-C84EzMlL.js";import{l as N,v as F}from"./utils-wQckQO4x.js";const v=5*1024*1024,l=(e,t)=>{try{const o=typeof t=="string"?t:JSON.stringify(t),a=N.compress(o);if(a.length>v)return console.error(`Cannot save ${e}: data exceeds size limit of ${v} bytes`),!1;const d={data:a,timestamp:new Date().toISOString(),version:"1.1"};return localStorage.setItem(e,JSON.stringify(d)),!0}catch(o){return console.error(`Failed to save data for key ${e}:`,o),!1}},c=(e,t)=>{try{const o=localStorage.getItem(e);if(!o)return t;const a=JSON.parse(o);if(a.data&&a.version){const d=N.decompress(a.data);if(!d)throw new Error("Decompression failed");return JSON.parse(d)}return JSON.parse(o)}catch(o){return console.error(`Failed to load data for key ${e}:`,o),t}},b=()=>c("notes",{notes:[],activeNoteId:null}),$=b(),s=e=>{l("notes",e)},I=u({name:"notes",initialState:$,reducers:{createNote:(e,t)=>{const o=new Date().toISOString(),a={id:F(),title:"新しいノート",content:"",folderId:t.payload.folderId,tags:[],createdAt:o,updatedAt:o,isPinned:!1};e.notes.unshift(a),e.activeNoteId=a.id,s(e)},updateNote:(e,t)=>{const o=e.notes.findIndex(a=>a.id===t.payload.id);o!==-1&&(e.notes[o]=p(f(f({},e.notes[o]),t.payload),{updatedAt:new Date().toISOString()}),s(e))},deleteNote:(e,t)=>{e.notes=e.notes.filter(o=>o.id!==t.payload),e.activeNoteId===t.payload&&(e.activeNoteId=e.notes.length>0?e.notes[0].id:null),s(e)},setActiveNote:(e,t)=>{e.activeNoteId=t.payload,s(e)},addTagToNote:(e,t)=>{const{noteId:o,tag:a}=t.payload,d=e.notes.find(r=>r.id===o);d&&!d.tags.includes(a)&&(d.tags.push(a),d.updatedAt=new Date().toISOString(),s(e))},removeTagFromNote:(e,t)=>{const{noteId:o,tag:a}=t.payload,d=e.notes.find(r=>r.id===o);d&&(d.tags=d.tags.filter(r=>r!==a),d.updatedAt=new Date().toISOString(),s(e))},togglePinNote:(e,t)=>{const o=e.notes.find(a=>a.id===t.payload);o&&(o.isPinned=!o.isPinned,o.updatedAt=new Date().toISOString(),s(e))},moveNoteToFolder:(e,t)=>{const{noteId:o,folderId:a}=t.payload,d=e.notes.find(r=>r.id===o);d&&(d.folderId=a,d.updatedAt=new Date().toISOString(),s(e))}}}),{createNote:U,updateNote:W,deleteNote:Y,setActiveNote:V,addTagToNote:ee,removeTagFromNote:te,togglePinNote:oe,moveNoteToFolder:ae}=I.actions,k=I.reducer,E=()=>c("ui-settings",{sidebarOpen:!0,searchQuery:"",darkMode:!1,fontSize:"medium",editorMaximized:!1,theme:"default"}),L=E(),n=e=>{l("ui-settings",e)},T=u({name:"ui",initialState:L,reducers:{toggleSidebar:e=>{e.sidebarOpen=!e.sidebarOpen,n(e)},setSidebarOpen:(e,t)=>{e.sidebarOpen=t.payload,n(e)},setSearchQuery:(e,t)=>{e.searchQuery=t.payload,n(e)},toggleDarkMode:e=>{e.theme!=="8313design"&&e.theme!=="sakura"&&(e.darkMode=!e.darkMode,n(e))},setFontSize:(e,t)=>{e.fontSize=t.payload,n(e)},toggleEditorMaximized:e=>{e.editorMaximized=!e.editorMaximized,n(e)},setEditorMaximized:(e,t)=>{e.editorMaximized=t.payload,n(e)},setTheme:(e,t)=>{e.theme=t.payload,t.payload==="8313design"&&(e.darkMode=!0),t.payload==="sakura"&&(e.darkMode=!1),n(e)}}}),{toggleSidebar:de,setSidebarOpen:re,setSearchQuery:se,toggleDarkMode:ne,setFontSize:ie,toggleEditorMaximized:le,setEditorMaximized:ce,setTheme:ge}=T.actions,R=T.reducer,J=()=>c("tags",{tags:[],activeTag:null}),P=J(),S=e=>{l("tags",e)},h=u({name:"tags",initialState:P,reducers:{addTag:(e,t)=>{e.tags.includes(t.payload)||e.tags.push(t.payload),S(e)},removeTag:(e,t)=>{e.tags=e.tags.filter(o=>o!==t.payload),e.activeTag===t.payload&&(e.activeTag=null);try{const o=c("notes",{notes:[],activeNoteId:null});if(o.notes&&Array.isArray(o.notes)){let a=!1;o.notes=o.notes.map(d=>d.tags&&Array.isArray(d.tags)&&d.tags.includes(t.payload)?(a=!0,p(f({},d),{tags:d.tags.filter(r=>r!==t.payload),updatedAt:new Date().toISOString()})):d),a&&l("notes",o)}}catch(o){console.error("Failed to update notes when removing tag:",o)}S(e)},setActiveTag:(e,t)=>{e.activeTag=t.payload,S(e)},reorderTags:(e,t)=>{e.tags=t.payload,S(e)}}}),{addTag:ue,removeTag:fe,setActiveTag:Se,reorderTags:pe}=h.actions,Q=h.reducer,C=()=>c("folders",{folders:[],activeFolderId:null}),_=C(),g=e=>{l("folders",e)},O=u({name:"folders",initialState:_,reducers:{createFolder:(e,t)=>{const o=new Date().toISOString(),a={id:F(),name:t.payload.name,parentId:null,createdAt:o,updatedAt:o};e.folders.push(a),g(e)},updateFolder:(e,t)=>{const o=e.folders.find(a=>a.id===t.payload.id);o&&(o.name=t.payload.name,o.updatedAt=new Date().toISOString()),g(e)},deleteFolder:(e,t)=>{e.folders=e.folders.filter(o=>o.id!==t.payload),e.activeFolderId===t.payload&&(e.activeFolderId=null),g(e)},setActiveFolder:(e,t)=>{e.activeFolderId=t.payload,g(e)},moveFolder:(e,t)=>{g(e)}}}),{createFolder:me,updateFolder:ye,deleteFolder:ve,setActiveFolder:Ne,moveFolder:Fe}=O.actions,j=O.reducer,G=()=>c("app-settings",{fontSize:"medium",fontFamily:"default",showNoteDates:!0,compactMode:!1,sortOrderNotes:"updatedDesc"}),X=G(),i=e=>{l("app-settings",e)},Z=u({name:"settings",initialState:X,reducers:{setFontSize:(e,t)=>{e.fontSize=t.payload,i(e)},setFontFamily:(e,t)=>{e.fontFamily=t.payload,i(e)},toggleShowNoteDates:e=>{e.showNoteDates=!e.showNoteDates,i(e)},toggleCompactMode:e=>{e.compactMode=!e.compactMode,i(e)},setSortOrderNotes:(e,t)=>{e.sortOrderNotes=t.payload,i(e)},resetSettings:e=>{const t={fontSize:"medium",fontFamily:"default",showNoteDates:!0,compactMode:!1,sortOrderNotes:"updatedDesc"};Object.assign(e,t),i(t)}}}),q=Z.reducer,Ie=x({reducer:{notes:k,folders:j,tags:Q,ui:R,settings:q},middleware:e=>e({serializableCheck:!1})});export{se as a,ue as b,le as c,Y as d,de as e,me as f,U as g,Ie as h,V as s,oe as t,W as u};
